services:
  postgres:
    image: postgres:16-alpine
    container_name: docker-manager-james-postgres
    hostname: james-postgres
    environment:
      POSTGRES_DB: james
      POSTGRES_USER: james
      POSTGRES_PASSWORD: james
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - ${jamesPath}/postgres-data:/var/lib/postgresql/data
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U james"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - james-network

  james:
    image: apache/james:jpa-latest
    container_name: docker-manager-james
    hostname: james.local
    depends_on:
      postgres:
        condition: service_healthy
    ports:
      - "25:25"     # SMTP
      - "143:143"   # IMAP
      - "465:465"   # SMTPS
      - "587:587"   # Submission
      - "993:993"   # IMAPS
      - "8001:8000" # WebAdmin API
    volumes:
      - ${jamesPath}/conf:/root/conf
      - ${jamesPath}/var:/root/var
      - ${jamesPath}/conf/webadmin.properties:/root/conf/webadmin.properties
      - ${jamesPath}/libs:/root/libs
    restart: unless-stopped
    environment:
      - TZ=Asia/Kolkata
    networks:
      - james-network

networks:
  james-network:
    driver: bridge