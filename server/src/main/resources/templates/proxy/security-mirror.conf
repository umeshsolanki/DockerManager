# Unified Security Mirroring (Danger/Burst/CIDR/4xx)
# This handles all mirrored security events in a single location
# Use 'internal' so it cannot be called directly from outside
location = /_security_mirror {
    internal;
    mirror_request_body off;
    
    # We pass the original status and the violation type from variables
    proxy_set_header X-Mirror-Status $expected_status;
    proxy_set_header X-Mirror-Reason $violation_reason;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Internal-Mirror "yes";
    
    proxy_pass http://${dangerProxyHost}/security/mirror${request_uri};
}
